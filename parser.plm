$list
/****h* plm/parser
 *
 * NAME
 *   parser
 *
 ******
 */
parser:
do;

$include (..\plmlib\plmlib.inc)
$include (toklit.inc)

declare stack (80) byte;
declare stack$idx uint;

/* Parser constants */
declare declaration literally '300';
declare assignment literally '310';

stack$push: procedure (x);
    declare x uint16;
    stack(stack$idx) = x mod 256;
    stack(stack$idx + 1) = x / 256;
    stack$idx = stack$idx + 2;
end stack$push;

stack$pop: procedure uint16;
    declare result uint16;
    stack$idx = stack$idx - 2;
    result = stack(stack$idx + 1) * 256;
    result = result + stack(stack$idx);
    return result;
end stack$pop;

/*
parse$loop: procedure;
end parse$loop;
*/

/****f* parser/parse
 *
 * NAME
 *   parse -- parse the input, generate the output
 *
 * SYNOPSIS
 *   call parse;
 *
 * DESCRIPTION
 *   Parse PL/M code using the tokenizer (from the source known by the
 *   tokenizer) and generate output code using the code generator.
 *
 ******
 */
/*
parse: procedure;
end parse;
*/

parse$rule: procedure (start$rule, p$str) byte;
    declare start$rule uint;
    declare p$str pointer;
    declare str based p$str (*) byte;
    /* TODO */
/*    call stack$push(rule$start); */
    return 0FFh; /* TODO: fix: temporary */
end parse$rule;

end parser;

